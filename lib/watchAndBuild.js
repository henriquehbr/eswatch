import{a as U}from"./chunk.FU2CJQ5F.js";var b=Object.create,l=Object.defineProperty,O=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,C=Object.getOwnPropertyNames,j=Object.getOwnPropertyDescriptor,L=t=>l(t,"__esModule",{value:!0}),I=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports),_=(t,e,s)=>{if(L(t),e&&typeof e=="object"||typeof e=="function")for(let o of C(e))!F.call(t,o)&&o!=="default"&&l(t,o,{get:()=>e[o],enumerable:!(s=j(e,o))||s.enumerable});return t},v=t=>t&&t.__esModule?t:_(l(t!=null?b(O(t)):{},"default",{value:t,enumerable:!0}),t),u=I((J,d)=>{"use strict";d.exports=t=>{const e=/^\\\\\?\\/.test(t),s=/[^\u0000-\u0080]+/.test(t);return e||s?t:t.replace(/\\/g,"/")}});import{spawn as V}from"child_process";import W from"readline";import k from"esbuild";import R from"is-glob";const c=v(u());import A from"path";import S from"tiny-glob";const $=async t=>{const e=A.normalize(t),s=c.default(e),o=await S(s),n=o.map(c.default);return n};var f=$;import{existsSync as B}from"fs";const G=async t=>{try{return await new Promise((e,s)=>B(t)?e(t):s(`Couldn't find ${t} entry point`))}catch(e){throw new Error(e)}};var y=G;const z=async t=>{const e=t._.length<1&&!t.entry;if(e)throw new Error("Missing entry point");const s=t.entry?[t.entry]:t._,o=s.map(async a=>R(a)?await f(a):await y(a)),n=await Promise.all(o),i=n.flat();return i};var g=z;import P from"path";import{fileURLToPath as D}from"url";import{builtinModules as M}from"module";const N=P.dirname(D(import.meta.url)),T=async t=>{const e=t.format==="esm"?t.splitting:!1,s=t.outext?{".js":t.outext}:{".js":".js"},o=t.outdir??P.join(N,"build"),n=[...M];if(!t.standalone){const{getDependencies:i}=await import("./getDependencies.js");n.push(...await i())}return t.external&&n.push(...t.external),{splitting:e,outExtension:s,outdir:o,external:n}};var h=T;let m,x;const r=U(),p=W.createInterface({input:process.stdin,output:process.stdout});g(r).then(t=>x=t);const q=async()=>{const{external:t,outExtension:e,splitting:s,outdir:o}=await h(r);m?.kill();const n=await k.startService();return r.clear&&console.clear(),await n.build({bundle:r.bundle,entryPoints:x,outExtension:e,format:r.format,minify:r.minify,outdir:o,platform:r.platform,...r.bundle&&{external:t,splitting:s}}),n.stop(),new Promise(i=>{if(r.run){p.pause();const a=typeof r.run=="string"?r.run:`node ${o}`,[w]=a.split(" "),E=a.split(" ").slice(1);m=V(w,E,{stdio:"inherit"}),m.on("close",()=>{p.resume(),r.watch?i():process.exit()})}else console.log(`${r.entry||r._.join(", ")} built successfully on ${r.outdir}`),p.close(),i()})};export{q as watchAndBuild};
