#!/usr/bin/env node
import _ from"minimist";import{existsSync as h}from"fs";const d=t=>{const s=t._.length<1&&!t.entry,a=!t._.every(r=>h(r));if(s)throw new Error("Missing entry point");if(a)throw new Error("Invalid entry point")};import c from"path";import w from"readline";import g from"esbuild";import{fileURLToPath as P}from"url";import{spawn as b}from"child_process";import{builtinModules as v}from"module";const E=c.dirname(P(import.meta.url));let n;const u=w.createInterface({input:process.stdin,output:process.stdout}),o=async t=>{const s=t.entry?[t.entry]:t._,a=t.format==="esm"?t.splitting:!1,r=t.outdir||c.join(E,"build"),l=[...v];if(!t.standalone){const{getDependencies:i}=await import("./getDependencies.js");l.push(...await i())}n&&n.kill();const p=await g.startService();return t.clear&&console.clear(),await p.build({bundle:t.bundle,platform:t.platform,...t.bundle&&{external:l,splitting:a},format:t.format,minify:t.minify,entryPoints:s,outdir:r}),new Promise(i=>{if(t.run){u.pause();const m=typeof t.run=="string"?t.run:`node ${r}`,f=m.split(" ").shift(),y=m.split(" ").slice(1);n=b(f,y,{stdio:"inherit"}),n.on("close",()=>{u.resume(),i()})}else i()})},e=_(process.argv.slice(2));d(e);e.watch?import("chokidar").then(({default:t})=>t.watch(e.watch).on("ready",async()=>o(e)).on("change",async()=>o(e))):o(e);
