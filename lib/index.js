import _ from"minimist";import{existsSync as h}from"fs";const d=t=>{const o=t._.length<1&&!t.entry,s=!t._.every(r=>h(r));if(o)throw new Error("Missing entry point");if(s)throw new Error("Entry point not found")};import c from"path";import w from"readline";import{fileURLToPath as g}from"url";import{spawn as P}from"child_process";import{builtinModules as b}from"module";import v from"esbuild";const E=c.dirname(g(import.meta.url));let i;const u=w.createInterface({input:process.stdin,output:process.stdout}),n=async t=>{const o=t.entry?[t.entry]:t._,s=t.format==="esm"?t.splitting:!1,r=t.outdir||c.join(E,"build"),l=[...b];if(!t.standalone){const{getDependencies:a}=await import("./getDependencies.js");l.push(...await a())}i&&i.kill();const p=await v.startService();return t.clear&&console.clear(),await p.build({bundle:t.bundle,platform:t.platform,...t.bundle&&{external:l,splitting:s},format:t.format,minify:t.minify,entryPoints:o,outdir:r}),new Promise(a=>{if(t.run){u.pause();const m=typeof t.run=="string"?t.run:`node ${r}`,f=m.split(" ").shift(),y=m.split(" ").slice(1);i=P(f,y,{stdio:"inherit"}),i.on("close",()=>{u.resume(),a()})}else console.log(`${t.entry||t._[0]} built successfully on ${t.outdir}`),process.exit()})},e=_(process.argv.slice(2));d(e);e.watch?import("chokidar").then(({default:t})=>t.watch(e.watch).on("ready",async()=>n(e)).on("change",async()=>n(e))):n(e);
