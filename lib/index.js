import _ from"minimist";import{existsSync as h}from"fs";const d=t=>{const a=t._.length<1&&!t.entry,o=!t._.every(r=>h(r));if(a)throw new Error("Missing entry point");if(o)throw new Error("Entry point not found")};import c from"path";import w from"readline";import{fileURLToPath as g}from"url";import{spawn as P}from"child_process";import{builtinModules as b}from"module";import E from"esbuild";const v=c.dirname(g(import.meta.url));let n;const u=w.createInterface({input:process.stdin,output:process.stdout}),s=async t=>{const a=t.entry?[t.entry]:t._,o=t.format==="esm"?t.splitting:!1,r=t.outdir||c.join(v,"build"),l=[...b];if(!t.standalone){const{getDependencies:i}=await import("./getDependencies.js");l.push(...await i())}n&&n.kill();const f=await E.startService();return t.clear&&console.clear(),await f.build({bundle:t.bundle,platform:t.platform,...t.bundle&&{external:l,splitting:o},format:t.format,minify:t.minify,entryPoints:a,outdir:r}),new Promise(i=>{if(t.run){u.pause();const m=typeof t.run=="string"?t.run:`node ${r}`,p=m.split(" ").shift(),y=m.split(" ").slice(1);n=P(p,y,{stdio:"inherit"}),n.on("close",()=>{u.resume(),t.watch?i():process.exit()})}else console.log(`${t.entry||t._[0]} built successfully on ${t.outdir}`),i()})},e=_(process.argv.slice(2));d(e);e.watch?import("chokidar").then(({default:t})=>t.watch(e.watch).on("ready",async()=>s(e)).on("change",async()=>s(e))):s(e);
